TABLEFORMAT={run:function($scope){$scope.cellValueExport=function(key,column,row,originalFormat){if(originalFormat)return row[key];if(column.export)return column.export(row);if(void 0!==column.formattype&&([ENUM.FORMAT.money,ENUM.FORMAT.percentage,ENUM.FORMAT.numeric]&&(column.sorttype=ENUM.FORMAT.numeric,column.class="text-left"),[ENUM.FORMAT.date,ENUM.FORMAT.time,ENUM.FORMAT.datetime]&&(column.sorttype=ENUM.FORMAT.time)),DSON.oseaX(row))return"";var value=eval("row."+key);if(void 0!==column.multilink){var titleLink="";return"function"==typeof column.format&&(titleLink=column.format(row)),column.sortable=!1,titleLink}if(void 0!==column.link){if(null===value)return"[N/A]";if("function"==typeof column.format&&(value=column.format(row)),column.shorttext&&"function"!=typeof column.format){var shorttext=value;return void 0!==shorttext?value:key}return value}if(value=$scope.formatByType(column,row,key),"function"==typeof column.format&&(value=column.format(row)),null==value)return column.null||"";if(column.shorttext){var shorttext=value;return shorttext}return value},$scope.cellValue=function(key,column,row){if(void 0!==column.formattype&&([ENUM.FORMAT.money,ENUM.FORMAT.percentage,ENUM.FORMAT.numeric]&&(column.sorttype=ENUM.FORMAT.numeric,column.class="text-left"),[ENUM.FORMAT.date,ENUM.FORMAT.time,ENUM.FORMAT.datetime]&&(column.sorttype=ENUM.FORMAT.time)),DSON.oseaX(row))return"";var value=eval("row."+key);if(void 0!==column.multilink){var titleLink="";return"function"==typeof column.format&&(titleLink=column.format(row)),column.sortable=!1,String.format("<a class='dragonlink'>{0}</a>",ICON.i("list",titleLink))}if(void 0!==column.link){if(null===value)return"<span class='text-grey'>[N/A]</span>";if("function"==typeof column.format&&(value=column.format(row)),column.shorttext&&"function"!=typeof column.format){var shorttext=value;return void 0!==shorttext?(shorttext.length>column.shorttext&&(shorttext=String.format("{0}",shorttext.substring(0,column.shorttext)+"...")),"<a class='dragonlink'>"+shorttext+"</a>"):`<span class='text-grey'>${key}</span>`}return"<a class='dragonlink'>"+value+"</a>"}if(value=$scope.formatByType(column,row,key),"function"==typeof column.format&&(value=column.format(row)),null==value)return column.null||"";if(column.shorttext){var shorttext=value;return shorttext.length>column.shorttext?shorttext=String.format(`<a title="${column.title||shorttext.replace(/(<([^>]+)>)/gi,"\r")}">{0}</a>`,shorttext.substring(0,column.shorttext)+"..."):column.showtext&&(shorttext=`<a title="${column.title||shorttext.replace(/(<([^>]+)>)/gi,"\r")}">${shorttext}</a>`),shorttext}return value},$scope.tableStatus=function(){var e=$scope.table.currentPage*$scope.table.currentLimit-($scope.table.currentLimit-1);return String.format(MESSAGE.i("table.tableStatus"),$scope.plural,MESSAGE.i("columns."+$scope.table.orderby),MESSAGE.i("mono."+$scope.table.order),e,e+($scope.table.currentCount-1),$scope.table.totalCount)},$scope.columnLabel=function(e,o,t){var a=e.label||o;return void 0===t&&"function"==typeof e.label?e.label():(MESSAGE.exist(`columns.${o}`)&&(a=capitalizeOneSpace(MESSAGE.i(`columns.${o}`))),capitalizeOneSpace(a))},$scope.columnLabelStrip=function(e,o){var t=e.label||o;return"function"==typeof e.label?HTML.strip(e.label()):HTML.strip(capitalize(t))},$scope.formatDataExport=function(data,extra){var formatedData=[],goData=extra.selected?$scope.records.data.filter(function(e){return!0===e.selected}):data,originalColumns=[];for(var i in $scope.columns())-1!==extra.columsAllow.indexOf(i)&&originalColumns.push(i);var goColums=originalColumns;return goData.forEach(function(row){var newRow={};goColums.forEach(function(column){var columnObj=$scope.columns()[column];if("date"==columnObj.formattype&&extra.orginalformat)return eval(`newRow.${column} = moment(row.${column}).format('YYYY-MM-DD');`);if("datetime"==columnObj.formattype&&extra.orginalformat)return eval(`newRow.${column} = moment(row.${column}).format('YYYY-MM-DD HH:mm:ss');`);if(extra.orginalformat)eval(`newRow.${column} = HTML.strip(row.${column});`);else{if("date"==columnObj.formattype||"datetime"==columnObj.formattype)return eval(`newRow.${column} = row.${column};`);if(!0===columnObj.export)eval(`newRow.${column} = HTML.strip(row.${column});`);else if("function"==typeof columnObj.format)eval(`newRow.${column} = columnObj.format(row);`);else{var goValue="";eval(`goValue = row.${column};`),goValue=$scope.formatByTypeClean($scope.columns()[column],row,column,extra),extra.onerow&&-1!==[ENUM.file.formats.CSV].indexOf(extra.type)&&(goValue=`"${goValue}"`),eval(`newRow.${column} = goValue;`)}}}),formatedData.push(newRow)}),formatedData},$scope.formatData=function(data,extra){var formatedData=[],goData=extra.selected?$scope.records.data.filter(function(e){return!0===e.selected}):data,originalColumns=[];for(var i in $scope.columns())-1!==extra.columsAllow.indexOf(i)&&originalColumns.push(i);var goColums=originalColumns;return goData.forEach(function(row){var newRow={};goColums.forEach(function(column){var columnObj=$scope.columns()[column];if(extra.orginalformat)eval(`newRow.${column} = HTML.strip(row.${column});`);else if("function"==typeof columnObj.format)eval(`newRow.${column} = columnObj.format(row);`);else{var goValue="";eval(`goValue = row.${column};`),goValue=$scope.formatByTypeClean($scope.columns()[column],row,column,extra),extra.onerow&&-1!==[ENUM.file.formats.CSV].indexOf(extra.type)&&(goValue=`"${goValue}"`),eval(`newRow.${column} = goValue;`)}}),formatedData.push(newRow)}),formatedData},$scope.formatByTypeClean=function(column,row,key,extra){var http=new HTTP,value=eval("row."+key);if(void 0!==column.multilink)return"...";if(void 0!==column.link)return null===value?"[N/A]":value;if(!0===column.anonymous&&(column.sortable=!1,data={$scope:$scope,row:row},value="function"==typeof column.value?column.value(data):column.value),void 0!==column.formattype){if(-1!==column.formattype.indexOf("datetime"))return DSON.oseaX(value)?DSON.noset():LAN.datetime(value);if(-1!==column.formattype.indexOf("date"))return DSON.oseaX(value)?DSON.noset():LAN.date(value);if(-1!==column.formattype.indexOf("time"))return DSON.oseaX(value)?DSON.noset():LAN.time(value);if(-1!==column.formattype.indexOf("money")){if(DSON.oseaX(value))return DSON.noset();var numeralValue=numeral(value)._value;return numeralValue?LAN.money(numeralValue).format(!0):LAN.money("0.00").format(!0)}if(-1!==column.formattype.indexOf("percentage"))return DSON.oseaX(value)?DSON.noset():value+"%";if(-1!==column.formattype.indexOf("password"))return DSON.oseaX(value)?DSON.noset():"*******";if(-1!==column.formattype.indexOf("creditcard"))return DSON.oseaX(value)?DSON.noset():value.length>4?"****-"+value.substr(value.length-4,4):"";if("bool"===column.formattype)return DSON.oseaX(value)?DSON.noset():value?MESSAGE.ic("mono.yes"):MESSAGE.ic("mono.no");if(-1!==column.formattype.indexOf("numeric")){if(DSON.oseaX(value))return"";var numeralValue=numeral(value)._value;return numeralValue?LAN.money(numeralValue).format(!1).split(LAN.money().s.decimal)[0]:"0"}if(-1!==column.formattype.indexOf("location"))return DSON.oseaX(value)?DSON.noset():-1!==[ENUM.file.formats.XLS,ENUM.file.formats.CSV,ENUM.file.formats.Clipboard].indexOf(extra.type)?value:extra.onerow?`<img src="https://maps.googleapis.com/maps/api/staticmap?center=${value}&zoom=16&size=600x300&maptype=roadmap&markers=color:red|label:C|${value}&key=AIzaSyB-T9ki1Z2Sw--ri0IB1solkM1cF_RENWE"/>`:`${value}`;if(-1!==column.formattype.indexOf("file")){if(extra.onerow){var format=column.formattype.split(":");if(format=format.length>1?format[1]:"",DSON.oseaX(value))return DSON.noset();var fileUrl=http.path([CONFIG.filePath,value]);if(-1!==[ENUM.file.formats.XLS,ENUM.file.formats.CSV,ENUM.file.formats.Clipboard].indexOf(extra.type))return fileUrl;switch(format){case"image":return String.format("<img src='{0}'/>",fileUrl);case"all":return FILE.noSupport(value)?MESSAGE.i("mono.NotSupport"):FILE.isImage(value)?String.format("<img src='{0}'/>",fileUrl):`<object style='width: 100%;height: 100%' data="${fileUrl}"></object>`}var fileUrl=http.path([CONFIG.filePath,value]);return`<img src="${fileUrl}"/>`}return http.path([CONFIG.filePath,value])}if(-1!==column.formattype.indexOf("html"))return extra.onerow?value:http.path([CONFIG.filePath,value]);if("color"===column.formattype)return value}return"function"==typeof column.format&&(value=column.format(value)),null==value?column.null||"":HTML.strip(value)},$scope.formatByType=function(column,row,key){var value=eval("row."+key);if(column.folder)switch(column.files){case"image":case"all":return String.format("<a data-dragonfile='/"+(column.folder+`/${value}`)+"' class='btn gallerybtn bg-"+COLOR.secundary+"'>{0}</a>",ICON.i("images3"));default:return String.format("<a class='dragonlink'>{0}</a>",ICON.i("files-empty"))}if(!0===column.anonymous&&(column.sortable=!1,data={$scope:$scope,row:row},value="function"==typeof column.value?column.value(data):column.value),void 0!==column.formattype){if(-1!==column.formattype.indexOf("datetime"))return DSON.oseaX(value)?DSON.noset():LAN.datetime(value);if(-1!==column.formattype.indexOf("date"))return DSON.oseaX(value)?DSON.noset():LAN.date(value);if(-1!==column.formattype.indexOf("time"))return DSON.oseaX(value)?DSON.noset():LAN.time(value);if(-1!==column.formattype.indexOf("money")){var numeralValue=numeral(value)._value;return LAN.money(numeralValue).format(!0)}if(-1!==column.formattype.indexOf("percentage"))return DSON.oseaX(value)?DSON.noset():value+"%";if(-1!==column.formattype.indexOf("password"))return DSON.oseaX(value)?DSON.noset():"*******";if(-1!==column.formattype.indexOf("creditcard"))return DSON.oseaX(value)?DSON.noset():value.length>4?"****-"+value.substr(value.length-4,4):"";if(-1!==column.formattype.indexOf("externalimage"))return DSON.oseaX(value)?DSON.noset():"<img src='"+value+"' class='tumbimage'>";if("bool"===column.formattype)return DSON.oseaX(value)?DSON.noset():value?MESSAGE.ic("mono.yes"):MESSAGE.ic("mono.no");if(-1!==column.formattype.indexOf("numeric")){if(DSON.oseaX(value))return"";var numeralValue=numeral(value)._value;return numeralValue?LAN.money(numeralValue).format(!1).split(LAN.money().s.decimal)[0]:"0"}if(-1!==column.formattype.indexOf("decimal")){if(DSON.oseaX(value))return"";var numeralValue=numeral(value)._value;return numeralValue?LAN.money(numeralValue).format(!1):LAN.money("0.00").format(!1)}if(-1!==column.formattype.indexOf("location")){if(DSON.oseaX(value))return DSON.noset();var location=value.split(";");if(location.length>1){var lat=location[0],lng=location[1];return"<a class='dragonlink'>"+ICON.i("location4")+"</a>"}}else{if("html"===column.formattype)return String.format("<a class='dragonlink'>{0}</a>",ICON.i("html5"));if("color"===column.formattype)return String.format("<a class='btn ' style='background-color: {1}' >{0}</a>",ICON.i("brush"),value);if(-1!==column.formattype.indexOf("file")){var format=column.formattype.split(":");if(format=format.length>1?format[1]:"",DSON.oseaX(value))return DSON.noset();var fileUrl=String.format("{0}/{1}",CONFIG.filePath,value);switch(format){case"image":return column.folder?String.format("<a class='dragonlink'>{0}</a>",ICON.i("images3"),fileUrl):String.format("<a class='dragonlink'>{0}</a>",FILE.fileToIcon(value),fileUrl);case"all":return column.folder?String.format("<a class='dragonlink'>{0}</a>",ICON.i(" files-empty"),fileUrl):FILE.noSupport(value)?"<a download href='"+fileUrl+"' class=''>"+FILE.fileToIcon(value)+"</a>":FILE.isImage(value)?String.format("<a class='dragonlink'>{0}</a>",FILE.fileToIcon(value),fileUrl):"<a class='dragonlink'>"+FILE.fileToIcon(value)+"</a>"}}}}return value},$scope.rowClass=function(row){return"function"==typeof eval(`CRUD_${$scope.modelName}`).table.rowClass?eval(`CRUD_${$scope.modelName}`).table.rowClass(row,$scope):""},$scope.rowStyle=function(row){return"function"==typeof eval(`CRUD_${$scope.modelName}`).table.rowStyle?eval(`CRUD_${$scope.modelName}`).table.rowStyle(row,$scope):""},$scope.rowDeleted=function(e){return!0===e.rowdeleted?"dragon-row-deleted":""},$scope.columns=function(){if(STORAGE.hasColumns($scope)){var storage_columns=STORAGE.getColumns($scope);return $scope.reorderColumn(storage_columns)}var hides=$scope.getModel("hideColumns");for(const key in eval(`CRUD_${$scope.modelName}`).table.columns)eval(`CRUD_${$scope.modelName}`).table.columns.hasOwnProperty(key)&&ARRAY.contains(hides,key)&&(eval(`CRUD_${$scope.modelName}`).table.columns[key].visible=!1);return eval(`CRUD_${$scope.modelName}`).table.columns},$scope.reorderColumn=function(storage_columns){var ordered={},hides=$scope.getModel("hideColumns");for(let obj of storage_columns)eval("ordered."+obj+" = eval(`CRUD_${$scope.modelName}`).table.columns."+obj),ARRAY.contains(hides,obj)&&eval("eval(`CRUD_${$scope.modelName}`).table.columns."+obj+".visible = false;");return ordered},$scope.LAN=LAN}};
