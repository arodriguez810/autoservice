<style>


    .cf:after {
        visibility: hidden;
        display: block;
        font-size: 0;
        content: " ";
        clear: both;
        height: 0;
    }


    .dd {
        position: relative;
        display: block;
        margin: 0;
        padding: 0;
        list-style: none;
        font-size: 15px;
        line-height: 20px;
    }

    .dd-list {
        display: block;
        position: relative;
        margin: 0;
        padding: 0;
        list-style: none;
    }

    /*.dd-list .dd-list {*/
    /*    padding-left: 30px;*/
    /*    width: 97%;*/
    /*}*/

    .dd-collapsed .dd-list {
        display: none;
    }

    .dd-item,
    .dd-empty,
    .dd-placeholder {
        display: block;
        position: relative;
        margin: 0;
        padding: 0;
        min-height: 20px;
        font-size: 15px;
        line-height: 20px;
    }

    .dd-handle {
        display: block;
        width: 40%;
        margin: 5px 0;
        padding: 10px 10px;
        text-align: initial;
        text-decoration: none;
        border: 1px solid #ccc;
        background: #004d80;
        color: white !important;
        font-size: 16px !important;
        border-radius: 3px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
    }

    .dd-subHandle {
        display: block;
        width: 30%;
        margin: 5px 0;
        padding: 10px 10px;
        text-align: initial;
        text-decoration: none;
        border: 1px solid #ccc;
        background: rgba(0, 65, 110, 0.87);
        color: white !important;
        font-size: 16px !important;
        border-radius: 3px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
    }


    .dd-item button {
        font-size: 32px !important;
        color: white;
    }

    .dd-handle:hover {
        color: #004d80 !important;
        border: 1px solid black;
        background: #fff;
    }

    .dd-subHandle:hover {
        color: #004d80 !important;
        border: 1px solid black;
        background: #fff;
    }

    .dd-subsubHandle:hover {
        color: #004d80 !important;
        border: 1px solid black;
        background: #fff;
    }

    .dd-item > button {
        display: block;
        position: relative;
        cursor: pointer;
        float: left;
        width: 25px;
        height: 20px;
        margin: 5px 0;
        padding: 0;
        text-indent: 100%;
        white-space: nowrap;
        overflow: hidden;
        border: 0;
        background: transparent;
        font-size: 15px;
        line-height: 1;
        text-align: center;
        font-weight: bold;
    }

    .dd-item > button:before {
        content: '+';
        display: block;
        position: absolute;
        width: 100%;
        text-align: center;
        text-indent: 0;
    }

    .dd-item > button[data-action="collapse"]:before {
        content: '-';
    }

    .dd-placeholder,
    .dd-empty {
        margin: 5px 0;
        padding: 0;
        min-height: 30px;
        background: #f2fbff;
        border: 1px dashed #b6bcbf;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
    }

    .dd-empty {
        border: 1px dashed #bbb;
        min-height: 100px;
        background-color: #e5e5e5;
        background-image: -webkit-linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff),
        -webkit-linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff);
        background-image: -moz-linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff),
        -moz-linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff);
        background-image: linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff),
        linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff);
        background-size: 60px 60px;
        background-position: 0 0, 30px 30px;
    }

    .dd-dragel {
        position: absolute;
        pointer-events: none;
        z-index: 9999;
    }

    .dd-dragel > .dd-item .dd-handle {
        margin-top: 0;
    }

    .dd-dragel .dd-handle {
        -webkit-box-shadow: 2px 4px 6px 0 rgba(0, 0, 0, .1);
        box-shadow: 2px 4px 6px 0 rgba(0, 0, 0, .1);
    }

    /**
     * Nestable Extras
     */

    .nestable-lists {
        display: block;
        clear: both;
        padding: 30px 0;
        width: 100%;
        border: 0;
        border-top: 2px solid #ddd;
        border-bottom: 2px solid #ddd;
    }

    #nestable-menu {
        padding: 0;
        margin: 20px 0;
    }

    #nestable-output,
    #nestable2-output {
        width: 100%;
        height: 7em;
        font-size: 0.75em;
        line-height: 1.333333em;
        font-family: Consolas, monospace;
        padding: 5px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
    }

    #nestable2 .dd-handle {
        color: #fff;
        border: 1px solid #999;
        background: #bbb;
        background: -webkit-linear-gradient(top, #bbb 0%, #999 100%);
        background: -moz-linear-gradient(top, #bbb 0%, #999 100%);
        background: linear-gradient(top, #bbb 0%, #999 100%);
    }

    #nestable2 .dd-handle:hover {
        background: #bbb;
    }

    #nestable2 .dd-item > button:before {
        color: #fff;
    }

    @media only screen and (min-width: 700px) {

        .dd {
            float: left;
            width: 100%;
        }

        .dd + .dd {
            margin-left: 2%;
        }

    }

    .dd-hover > .dd-handle {
        background: #2ea8e5 !important;
    }

    /**
     * Nestable Draggable Handles
     */

    .dd3-content {
        display: block;
        height: 30px;
        margin: 5px 0;
        padding: 5px 10px 5px 40px;
        color: #333;
        text-decoration: none;
        font-weight: bold;
        border: 1px solid #ccc;
        background: #fafafa;
        background: -webkit-linear-gradient(top, #fafafa 0%, #eee 100%);
        background: -moz-linear-gradient(top, #fafafa 0%, #eee 100%);
        background: linear-gradient(top, #fafafa 0%, #eee 100%);
        -webkit-border-radius: 3px;
        border-radius: 3px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
    }

    .dd3-content:hover {
        color: #2ea8e5;
        background: #fff;
    }

    .dd-dragel > .dd3-item > .dd3-content {
        margin: 0;
    }

    .dd3-item > button {
        margin-left: 30px;
    }

    .dd3-handle {
        position: absolute;
        margin: 0;
        left: 0;
        top: 0;
        cursor: pointer;
        width: 30px;
        text-indent: 100%;
        white-space: nowrap;
        overflow: hidden;
        border: 1px solid #aaa;
        background: #ddd;
        background: -webkit-linear-gradient(top, #ddd 0%, #bbb 100%);
        background: -moz-linear-gradient(top, #ddd 0%, #bbb 100%);
        background: linear-gradient(top, #ddd 0%, #bbb 100%);
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }

    .dd3-handle:before {
        content: '≡';
        display: block;
        position: absolute;
        left: 0;
        top: 3px;
        width: 100%;
        text-align: center;
        text-indent: 0;
        color: #fff;
        font-size: 20px;
        font-weight: normal;
    }

    .dd3-handle:hover {
        background: #ddd;
    }

    /**
     * Socialite
     */

    .socialite {
        display: block;
        float: left;
        height: 35px;
    }

    .dd-item .dd-item .dd-handle {
        display: block;
        width: 30%;
        margin: 5px 0;
        padding: 10px 10px;
        text-align: initial;
        text-decoration: none;
        border: 1px solid #ccc;
        background: #187bc5 !important;
        color: white !important;
        font-size: 16px !important;
        border-radius: 3px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
    }

    .dd-item .dd-item .dd-item .dd-subHandle {
        display: block;
        width: 25%;
        margin: 5px 0;
        padding: 10px 10px;
        text-align: initial;
        text-decoration: none;
        border: 1px solid #ccc;
        background: #6e1414 !important;
        color: white !important;
        font-size: 16px !important;
        border-radius: 3px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
    }

</style>
<style>
    .myinputs {
        height: 40px;
        font-size: 16px;
        padding-top: 0px !important;
        float: right;
        width: 25%;
        color: black !important;
        display: none;
    }

    .myinputsfull {
        height: 40px;
        font-size: 16px;
        padding-top: 0px !important;
        float: right;
        width: 50%;
        color: black !important;
        display: none;
    }

    .dd-item:hover .myinputs {
        display: block;

    }

    .dd-item:hover .myinputsfull {
        display: block;

    }
</style>
<div id="information" ng-controller="information as information" style="text-align: center">
    <script>
        <%= scope %>.saveMenu = function () {
            information.datajson = $('#taxonomia').nestable('serialize');
            for (var item in information.datajson) {
                delete information.datajson[item].$scope;
                information.datajson[item].menus = information.datajson[item].children;
                delete information.datajson[item].children;
                for (var i in information.datajson[item].menus) {
                    delete information.datajson[item].menus[i].$scope;
                    information.datajson[item].menus[i].menus = information.datajson[item].menus[i].children;
                    delete information.datajson[item].menus[i].children;
                    for (var j in information.datajson[item].menus[i].menus) {
                        delete information.datajson[item].menus[i].menus[j].$scope;
                    }
                }
            }
            console.log(information.datajson);
            var renderCompania = new SESSION().current().institucion_id ? ('I' + new SESSION().current().institucion_id) : ('C' + new SESSION().current().compania_id);
            if (new SESSION().current().compania_id === null)
                renderCompania = "";
            SWEETALERT.confirm({
                message: "Desea guardar los cambios realizados en el menú?",
                confirm: function () {
                    SWEETALERT.loading({message: "Guardando..."});
                    BASEAPI.ajax.post('/menu/edit', {
                        json: JSON.stringify(information.datajson),
                        compania: renderCompania,
                        file: (new SESSION().current().tipo_institucion == ENUM_2.COMPANY_TYPE.publica ? `menu${renderCompania}.json` : `menus_privado${renderCompania}.json`)
                    }, function () {
                        SWEETALERT.loading({message: MESSAGE.ic('mono.saving')});
                        setTimeout(() => {
                            location.reload();
                        }, 8000);
                    });
                }
            });
        };
    </script>
    <div class="col-md-12">

        <button style="margin-top: 10px"
                dragonlanguage="" title="Guardar"
                type="button" role="button"
                class=" btn bg-<%= COLOR.success %>-800 btn-labeled btn-xs pull-left"
                ng-click="information.addMainMenu()">
            <b><i class="icon-floppy-disk"></i></b>
            Agregar Menu
        </button>
        <button style="margin-top: 10px"
                dragonlanguage="" title="Guardar"
                type="button" role="button"
                class=" btn bg-<%= COLOR.success %>-800 btn-labeled btn-xs pull-right"
                ng-click="<%= scope %>.saveMenu()">
            <b><i class="icon-floppy-disk"></i></b>
            Actualizar Menu
        </button>
        <br>
        <br>
        <br>
        <div class="dd" id="taxonomia">
            <ol class="dd-list">
                <li ng-repeat="(key, menu) in information.menusall track by key"
                    class="{{menu.class}} dd-item"
                    data-text="{{menu.text}}" data-href="{{menu.href}}" data-icon="{{menu.icon}}"
                    data-modal="{{menu.modal}}" data-menus="{{menu.menus}}">

                    <button ng-if="menu.menus" data-action="collapse" type="button">Collapse</button>
                    <button ng-if="menu.menus" data-action="expand" type="button" style="display: none;">Expand</button>

                    <button style="float: right" class=" btn btn-danger  " ng-click="information.menusall.splice(key,1)"
                            ng-if="menu.href=='#' && (!menu.menus || menu.menus.length===0)">
                        <i class=" icon-trash " title="Eliminar"></i>
                    </button>
                    <select ng-if="menu.href!='#'" ng-model="menu.modal" class="myinputs">
                        <option value="">Cargar en contendio</option>
                        <option value="modal-full">Cargar en una ventana grande</option>
                        <option value="modal-lg">Cargar en una ventana mediana</option>
                    </select>
                    <input type="text" ng-model="menu.text"
                           class="{{menu.href!='#'?'myinputs':'myinputsfull'}}">

                    <a data-modal="{{menu.modal}}"
                       class="bg-extra-700  dd-handle">
                        <i class="icon-home2"></i>
                        <span>
                       {{baseController.menuLabel(menu)}}
                        <i class="icon-windows2" ng-if="menu.modal"
                           title="Este menú abre en una ventana"
                           style="color: darkgoldenrod"></i>
                        <i class="icon-unlink"
                           title="Este menú no contiene enlace"
                           ng-if="menu.href=='#'" style="color: darkgoldenrod"></i>

                    </span>
                    </a>


                    <ol data-nivel="2" class="sort-menu dd-list" ng-if="menu.menus">

                        <li ng-repeat="(key2, segundo) in menu.menus track by key2"
                            ng-init="innerIndex2=$parent.$index + '' + $index" class="{{segundo.class}} dd-item"
                            data-text="{{segundo.text}}" data-href="{{segundo.href}}"
                            data-icon="{{segundo.icon}}"
                            data-modal="{{segundo.modal}}" data-menus="{{segundo.menus}}">

                            <button ng-if="segundo.menus" data-action="collapse" type="button">Collapse</button>
                            <button ng-if="segundo.menus" data-action="expand" type="button" style="display: none;">
                                Expand
                            </button>

                            <select ng-if="segundo.href!='#'" ng-model="segundo.modal"
                                    class="{{segundo.href!='#'?'myinputs':'myinputsfull'}}">
                                <option value="">Cargar en contendio</option>
                                <option value="modal-full">Cargar en una ventana grande</option>
                                <option value="modal-lg">Cargar en una ventana mediana</option>
                            </select>
                            <input type="text" ng-model="segundo.text" class="myinputs">
                            <a data-modal="{{segundo.modal}}"
                               class="bg-extra-700  dd-handle dd-subHandle">
                                <i class="icon-lifebuoy"></i>
                                <span>
                                {{baseController.menuLabel(segundo)}}
                                <i class="icon-windows2" ng-if="segundo.modal"
                                   title="Este menú abre en una ventana"
                                   style="color: darkgoldenrod"></i>
                                <i class="icon-unlink" ng-if="segundo.href=='#'"
                                   title="Este menú no contiene enlace"
                                   style="color: darkgoldenrod"></i>
                             </span>
                            </a>
                            <ol data-nivel="3" class="sort-menu dd-list" ng-if="segundo.menus">

                                <li ng-repeat="(key3, tercero) in segundo.menus track by key3"
                                    ng-init="innerIndex3= $parent.$index + '' + $index"
                                    class="{{tercero.class}} dd-item"
                                    data-text="{{tercero.text}}" data-href="{{tercero.href}}"
                                    data-icon="{{tercero.icon}}"
                                    data-modal="{{tercero.modal}}" data-menus="{{tercero.menus}}">
                                    <select ng-if="tercero.href!='#'" ng-model="tercero.modal"
                                            class="{{tercero.href!='#'?'myinputs':'myinputsfull'}}">
                                        <option value="">Cargar en contendio</option>
                                        <option value="modal-full">Cargar en una ventana grande</option>
                                        <option value="modal-lg">Cargar en una ventana mediana</option>
                                    </select>
                                    <input type="text" ng-model="tercero.text" class="myinputs">
                                    <a data-modal="{{tercero.modal}}"
                                       class="bg-extra-700  dd-handle dd-subHandle">
                                        <i class="icon-lifebuoy"></i>
                                        <span>
                                {{baseController.menuLabel(tercero)}}
                                <i class="icon-windows2" ng-if="tercero.modal"
                                   title="Este menú abre en una ventana"
                                   style="color: darkgoldenrod"></i>
                                <i class="icon-unlink" ng-if="tercero.href=='#'"
                                   title="Este menú no contiene enlace"
                                   style="color: darkgoldenrod"></i>
                             </span>

                                    </a>


                                </li>

                            </ol>

                        </li>

                    </ol>
                </li>
                <br>
                <br>
                <br>
                <button style="margin-top: -55px"
                        dragonlanguage="" title="Guardar"
                        type="button" role="button"
                        class=" btn bg-<%= COLOR.success %>-800 btn-labeled btn-xs pull-right"
                        ng-click="<%= scope %>.saveMenu()">
                    <b><i class="icon-floppy-disk"></i></b>
                    Actualizar Menu
                </button>
            </ol>
        </div>
    </div>
</div><!--end-->
<script>
    information.datajson = [];
    $(document).ready(function () {
        $('#taxonomia').nestable({items: "li:not(.unsortable)", maxDepth: 3});
    });

    information.refreshAngular();
</script>
